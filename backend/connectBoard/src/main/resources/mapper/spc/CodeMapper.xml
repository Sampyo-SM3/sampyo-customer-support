<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.connectBoard.repository.spc.CodeRepository">

	<!--접수 상태 List-->
    <select id="getCodes" parameterType="String" resultType="com.example.connectBoard.dto.CodeDTO">   
		SELECT 
			codeId, 
			codeName, 
			codeDesc, 
			category, 
			parentCodeId, 
			useYn, 
			orderNum,
			insertDt, 
			updateDt			
		FROM code_master
		WHERE category = #{category}
		ORDER BY orderNum;
    </select>
	    
	    
	       
    	    
	<!--문의유형별 count-->
	<select id="getCodeCount" parameterType="com.example.connectBoard.dto.CodeDTO" resultType="com.example.connectBoard.dto.CodeDTO">
	    SELECT
	        c.codeName,
	        b.inquiryType,
	        c.orderNum,
	        count(*) as cnt
	    FROM board b
	    INNER JOIN code_master c ON b.inquiryType = c.codeId
	    WHERE b.inquiryType &lt;&gt; ''
		<if test="startDate != null and startDate != ''">
		    AND b.requestDate &gt;= #{startDate}
		</if>
		<if test="endDate != null and endDate != ''">
		    AND b.requestDate &lt;= #{endDate}
		</if>
		<if test="writerId != null and writerId != ''">
			AND b.writerId = #{writerId}
		</if>	
		<if test="writerDp != null and writerDp != ''">
			AND b.dpId = #{writerDp}
		</if>	

	
 		<if test="managerId != null and managerId != ''">
 		
			AND b.managerId = #{managerId}
		</if>	
			
		<if test="managerDp != null and managerDp != ''">	
			AND b.managerId IN (select id from sys_empref where DEPART1 in (select depart1 from sys_empref where id = #{managerDp}))
		</if>						

		
			
	    GROUP BY b.inquiryType, c.orderNum, c.codeName
	    ORDER BY c.orderNum
	</select>
    




<!--asdsdd
select inquiryType, orderNum, count(*) as cnt from board b inner join code_master c on b.inquiryType = c.codeId
where inquiryType <> ''
group by inquiryType, orderNum
order by c.orderNum

-->    

</mapper>

